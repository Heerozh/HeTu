<!--
同步影响报告
- 版本变更：模板占位符（未定） → 1.0.0
- 修改的原则列表：
	- 新增：一、代码质量优先
	- 新增：二、测试标准不可妥协
	- 新增：三、性能需求持续保障
- 新增章节：附加约束、开发流程与质量门禁（由模板占位章节实化）
- 删除章节：无
- 模板与文档同步状态：
	- ✅ updated: .specify/templates/plan-template.md
	- ✅ updated: .specify/templates/spec-template.md
	- ✅ updated: .specify/templates/tasks-template.md
	- ⚠ pending: .specify/templates/commands/*.md（目录不存在，待后续引入命令模板后复核）
	- ✅ checked: README.md（未发现宪章原则直接引用，无需改动）
- 延期项：
	- TODO(RATIFICATION_DATE): 首次批准日期待项目维护者确认
-->

# HeTu 宪章

## Core Principles

### 一、代码质量优先
所有合并到主干的代码变更 MUST 满足以下最低门槛：

- 通过格式化与静态检查：`ruff format`、`ruff check`、`basedpyright`。
- 遵守仓库约定的命名、文档与结构风格，公共 API SHOULD 提供中英双语说明。
- 变更 SHOULD 保持最小化与可读性，不得以“临时方案”绕过质量门禁。

Rationale：高并发、长连接与事务重试场景对可维护性敏感，低质量改动会放大线上故障成本。

### 二、测试标准不可妥协
所有功能性改动 MUST 提供可复现验证，测试策略如下：

- 缺陷修复 MUST 先补测试，确保可稳定复现后再修复。
- 新增或变更行为 MUST 至少覆盖对应单元测试或集成测试之一；涉及事务、订阅、权限、并发冲突的改动 SHOULD 增加集成测试。
- 提交前 MUST 运行受影响测试；发布前 SHOULD 运行完整测试集，并在可行时与 CI 环境变量保持一致（例如 `HETU_TEST_BACKENDS=redis`）。

Rationale：ECS + Redis + WebSocket 的交互链路长，未被测试覆盖的回归极易跨模块扩散。

### 三、性能需求持续保障
性能不是一次性优化，而是持续约束。所有改动 MUST 满足：

- 不得引入明显可避免的性能退化（如无界扫描、重复序列化、热点路径阻塞 I/O）。
- 涉及核心路径（RPC 调用、订阅推送、会话事务、批量读写）时 SHOULD 提供基准或对比数据。
- 在缺乏硬性阈值场景下，团队 MUST 使用“与现有基线等价或更优”作为验收标准，并记录评估方法。

Rationale：HeTu 的核心价值是高性能与可扩缩容，性能回退即产品能力回退。

## 附加约束

- 技术栈约束：服务端 Python 版本 MUST 与项目声明保持一致；新增依赖 SHOULD 评估体积、维护性与许可风险。
- 架构约束：改动 MUST 尊重 Component/System/Endpoint 职责边界，不得将跨层逻辑耦合到单一模块。
- 可运维性约束：关键异常路径 SHOULD 保留可追踪日志，避免“吞异常”与无上下文报错。

## 开发流程与质量门禁

- 需求实现前 SHOULD 明确验收标准（行为、测试、性能影响）。
- 代码评审 MUST 检查三类合规性：代码质量、测试充分性、性能影响说明。
- 合并前 MUST 至少完成一次自动化检查与一次人工评审。
- 对核心模块的高风险改动 SHOULD 附变更说明，包含回滚策略或降级路径。

## Governance

本宪章高于团队内其他临时实践约定。任何流程、模板或执行细则与本宪章冲突时，
以本宪章为准。

修订流程：

1. 提交宪章修订草案，说明动机、影响范围与迁移要求。
2. 经维护者评审通过后生效，并同步更新相关模板与运行文档。
3. 修订完成后 MUST 在本文件顶部更新同步影响报告。

版本策略（语义化版本）：

- MAJOR：删除或重定义原则，造成治理语义不兼容。
- MINOR：新增原则/章节，或显著扩展强制流程。
- PATCH：措辞澄清、错别字修复、非语义优化。

合规审查预期：

- 每个 PR MUST 声明其对代码质量、测试与性能的影响。
- 评审者 MUST 记录不合规项与处理结论（修复、豁免或延期）。
- 任何豁免 MUST 具备理由、责任人和到期处理时间。

**Version**: 1.0.0 | **Ratified**: TODO(RATIFICATION_DATE): 首次批准日期待项目维护者确认 | **Last Amended**: 2026-02-15
